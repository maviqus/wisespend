#!/bin/bash

set -e

echo "ğŸ”§ Fixing xcconfig includes..."

# ThÃªm dÃ²ng include vÃ o Ä‘áº§u má»—i file náº¿u chÆ°a cÃ³
add_include_if_missing() {
  local file=$1
  local include=$2
  if ! grep -q "$include" "$file"; then
    echo "âœ… Adding include to $file"
    sed -i '' "1s;^;#include \"$include\"\n;" "$file"
  else
    echo "âœ”ï¸  Include already exists in $file"
  fi
}

cd ios || { echo "âŒ ios directory not found"; exit 1; }

add_include_if_missing Flutter/Debug.xcconfig "Pods/Target Support Files/Pods-Runner/Pods-Runner.debug.xcconfig"
add_include_if_missing Flutter/Release.xcconfig "Pods/Target Support Files/Pods-Runner/Pods-Runner.release.xcconfig"
add_include_if_missing Flutter/Profile.xcconfig "Pods/Target Support Files/Pods-Runner/Pods-Runner.profile.xcconfig"

echo "ğŸ§¹ Cleaning old Pods..."
rm -rf Pods Podfile.lock

echo "ğŸ“¦ Installing pods..."
pod install

cd ..

echo "ğŸ“¦ Running flutter pub get..."
flutter pub get

echo "âœ… Done! Ready to build ğŸ‰"


